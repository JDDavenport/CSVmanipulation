<head>
  <meta charset="utf-8" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.0/papaparse.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/vuex"></script>
</head>


<body>
  <div id="vapp">
    <h1>Burn up Generator</h1>
    <br><br>
    <div v-if="finished">
     
    <label>Canada: </label><input type="checkbox" v-model="isCanada" v-on:change="changeP('c')">
    <label>Corporate: </label><input type="checkbox" v-model="isCorporate" v-on:change="changeP('ca')">
    <div v-if="(isCanada || isCorporate)" v-for="sprint in AllP">
      <label>{{sprint}} </label><input type="checkbox" v-model="headersForBurnUp" v-bind:value="sprint">
    </div>
    <br><br>
    <input type="file" id="file" ref="myFiles" class="custom-file-input" @change="previewFiles" multiple
      v-if="isCanada || isCorporate">
    <button id="fireburnout" v-on:click="getBurnout()" v-if="isFile && (isCanada || isCorporate)">Get
      burnout</button>
    </div>
    <button id="fireburnoutRefresh" v-on:click="changeF()" v-if="!finished">New burnout</button>

    <table v-if="isFired">
      <tr>
        <th v-for="(header, index) in headersForBurnUp">
          {{header}}</th>
      </tr>
      <tr v-for="rowData in AllData">
        <td>{{rowData[0]}}</td>
        <td v-if="p1">
          {{rowData[1]}}
        </td>
        <td v-if="p21">
          {{!isCanada ? rowData[1] : rowData[2]}}
        </td>
        <td v-if="p22">
          {{!isCanada ? rowData[2] : rowData[3]}}
        </td>
        <td v-if="p23">
          {{!isCanada ? rowData[3] : rowData[4]}}
        </td>
        <td v-if="p24">
          {{!isCanada ? rowData[4] : rowData[5]}}
        </td>
        <td v-if="p25">
          {{!isCanada ? rowData[5] : rowData[6]}}
        </td>
        <td v-if="p26">
          {{rowData[7]}}
        </td>

      </tr>
    </table>
  </div>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="/__/firebase/6.2.0/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
   https://firebase.google.com/docs/web/setup#reserved-urls -->

  <!-- Initialize Firebase -->
  <script src="/__/firebase/init.js"></script>
</body>



<script>

  const vueApp = new Vue({
    el: '#vapp',
    data() {
      return {
        files: [],
        newData: [],
        isFile: false,
        isFired: false,
        headers: [],
        rows: [0, 0, 0, 0, 0],
        firstCl: [
          "Refined Scope",
          "Committed",
          "Completed Burn up",
          "Completed Burn up + QA + Business Validation"
        ],
        iteration: 0,
        allStatus: [],
        countAllStatus: 0,
        headersCanada: ["PI_1", "PI_2.1", "PI_2.2", "PI_2.3", "PI_2.4", "PI_2.5", "PI_2.6"],
        headersCorporate: ["PI_2.1", "PI_2.2", "PI_2.3", "PI_2.4", "PI_2.5"],
        AllP: ["PI_1", "PI_2.1", "PI_2.2", "PI_2.3", "PI_2.4", "PI_2.5", "PI_2.6"],
        headersForBurnUp: [],
        PIheadersCorporate: "",
        isCanada: false,
        isCorporate: false,
        AllData: [],
        AllStorypointsSum: 0,
        p1: false,
        p21: false,
        p22: false,
        p23: false,
        p24: false,
        p25: false,
        p26: false,
        finished: true


      }
    },
    methods: {
      previewFiles() {
        console.log("welcome")
        this.files = this.$refs.myFiles.files[0]
        console.log(this.files)
        Papa.parse(this.files, this.buildConfig())
        //console.log(newData.data)
      },
      buildConfig() {
        return {
          complete: this.completeFn
        };
      },
      completeFn(results) {
        this.newData = results.data;
        let one = 0;
        this.newData.forEach(element => {
          let count = 0;
          let PI = "";
          let st = "";
          let s = "";
          if (one > 3) {


            element.forEach(el => {

              let current = [];

              console.log("instatus")
              if (!this.isCanada) {
                if (count == 8)
                  PI = el
                if (count == 10) {

                  st = el
                }
                if (count == 11) {
                  if ((el != "") && (st != null) && (PI != null)) {
                    s = parseInt(el)
                    this.AllStorypointsSum += parseInt(el)
                    current = [st, PI, s]
                    this.allStatus.push(current)
                  }


                }
              }

              else {

                if (count == 5)
                  PI = el
                if (count == 9) {
                  st = el

                }
                if (count == 10) {
                  if ((el != "") && (st != null) && (PI != null)) {
                    s = parseInt(el)
                    this.AllStorypointsSum += parseInt(el)
                    current = [st, PI, s]
                    this.allStatus.push(current)
                  }
                }
              }
              count++
            })
          }
          one++
        });
        this.countAllStatus = this.allStatus.length
        this.isFile = true;
        self = this;
        let countH = 0

        this.firstCl.forEach(element => {
          let json = [element];

          this.AllData.push(json)
          self.AllP.forEach(el => {
            let p = 0
            if (element == "Refined Scope") {
              let p = this.AllStorypointsSum
              this.AllData[countH].push(p);

            }
            else {

              this.AllData[countH].push(p);
            }
          })
          countH++

        });
      },
      changeP(cOca){
        self = this
        console.log(cOca)
        console.log(this.isCanada)
        

        // if((cOca == 'c'))
        // {
        //   self.AllP = self.headersCanada
        // }
        // else
        // {
        //   self.AllP = self.headersCorporate
          
        // }
        if (!self.isCanada){
          self.AllP = self.headersCorporate
        console.log("changed p to c")

        }
        else{
          self.AllP = self.headersCanada
        console.log("changed p to ca")

        }
      },
      changeF(){
        // self = this
        // self.finished = true;
        // self.isFired = false;
        console.log("in change F")
        location.reload()
        
      },
      getBurnout() {
        self = this
        // if (!self.isCanada) {
        //   self.headersForBurnUp = self.headersCorporate
        // }
        // else {
        //   self.headersForBurnUp = self.headersCanada
        // }
        this.isFired = true;
        if (!self.isCorporate) {
          // self.allStatus.forEach(element => {

          // self.headersForBurnUp.forEach(el =>{

          // })
          // })
          count =0
          self.allStatus.forEach(element => {
            console.log("in for each loop")

            if (element[1] == "PI 1") {
              this.AllData[1][1] += element[2]

            }
            else if (element[1] == "PI_2.1") {
              this.AllData[1][2] += element[2]
            }
            else if (element[1] == "PI_2.2") {
              this.AllData[1][3] += element[2]
            }
            else if (element[1] == "PI_2.3") {
              this.AllData[1][4] += element[2]
            }
            else if (element[1] == "PI_2.4") {
              this.AllData[1][5] += element[2]
            }
            else if (element[1] == "PI_2.5") {
              this.AllData[1][6] += element[2]
            }
            else if (element[1] == "PI_2.6") {
              this.AllData[1][7] += element[2]
            }
            if ((element[0] == "Closed") || (element[0] == "Done") || (element[0] == "Ready for Deployment") || (element[0] == "Sprint Complete")) {
              if (element[1] == "PI 1") {
                this.AllData[2][1] += element[2]

              }
              else if (element[1] == "PI_2.1") {
                this.AllData[2][2] += element[2]
              }
              else if (element[1] == "PI_2.2") {
                this.AllData[2][3] += element[2]
                
                
              }
              else if (element[1] == "PI_2.3") {
                this.AllData[2][4] += element[2]
              }
              else if (element[1] == "PI_2.4") {
                this.AllData[2][5] += element[2]
              }
              else if (element[1] == "PI_2.5") {
                this.AllData[2][6] += element[2]
              }
              else if (element[1] == "PI_2.6") {
                this.AllData[2][7] += element[2]
              }
            }
            if ((element[0] == "Closed") || (element[0] == "Done") || (element[0] == "Ready for Deployment") || (element[0] == "Sprint Complete") || (element[0] == "QA Testing") || (element[0] == "Business Validation")) {
              if (element[1] == "PI 1") {
                this.AllData[3][1] += element[2]

              }
              if (element[1] == "PI_2.1") {
                this.AllData[3][2] += element[2]
              }
              if (element[1] == "PI_2.2") {
                this.AllData[3][3] += element[2]
              }
              if (element[1] == "PI_2.3") {
                this.AllData[3][4] += element[2]
              }
              if (element[1] == "PI_2.4") {
                this.AllData[3][5] += element[2]
              }
              if (element[1] == "PI_2.5") {
                this.AllData[3][6] += element[2]
              }
              if (element[1] == "PI_2.6") {
                this.AllData[3][7] += element[2]
              }
            }
          });
          this.AllData[1][2] += this.AllData[1][1]
          this.AllData[1][3] += this.AllData[1][2]
          this.AllData[1][4] += this.AllData[1][3]
          this.AllData[1][5] += this.AllData[1][4]
          this.AllData[1][6] += this.AllData[1][5]
          this.AllData[1][7] += this.AllData[1][6]
          this.AllData[2][2] += this.AllData[2][1]
          this.AllData[2][3] += this.AllData[2][2]
          this.AllData[2][4] += this.AllData[2][3]
          this.AllData[2][5] += this.AllData[2][4]
          this.AllData[2][6] += this.AllData[2][5]
          this.AllData[2][7] += this.AllData[2][6]
          this.AllData[3][2] += this.AllData[3][1]
          this.AllData[3][3] += this.AllData[3][2]
          this.AllData[3][4] += this.AllData[3][3]
          this.AllData[3][5] += this.AllData[3][4]
          this.AllData[3][6] += this.AllData[3][5]
          this.AllData[3][7] += this.AllData[3][6]

        }
        else {
          self.allStatus.forEach(element => {
            console.log("in for each loop")

            if (element[1] == "PI_2.1") {
              this.AllData[1][1] += element[2]
            }
            else if (element[1] == "PI_2.2") {
              this.AllData[1][2] += element[2]
            }
            else if (element[1] == "PI_2.3") {
              this.AllData[1][3] += element[2]
            }
            else if (element[1] == "PI_2.4") {
              this.AllData[1][4] += element[2]
            }
            else if (element[1] == "PI_2.5") {
              this.AllData[1][5] += element[2]
            }

            if ((element[0] == "Done") || (element[0] == "Ready for Deployment") || (element[0] == "Sprint Complete")) {
//(element[0] == "Closed") || 
              if (element[1] == "PI_2.1") {
                this.AllData[2][1] += element[2]
              }
              else if (element[1] == "PI_2.2") {
                this.AllData[2][2] += element[2]
              }
              else if (element[1] == "PI_2.3") {
                this.AllData[2][3] += element[2]
              }
              else if (element[1] == "PI_2.4") {
                this.AllData[2][4] += element[2]
              }
              else if (element[1] == "PI_2.5") {
                this.AllData[2][5] += element[2]
              }

            }
            if ((element[0] == "Closed") || (element[0] == "Done") || (element[0] == "Ready for Deployment") || (element[0] == "Sprint Complete") || (element[0] == "QA Testing") || (element[0] == "Business Validation")) {

              if (element[1] == "PI_2.1") {
                this.AllData[3][1] += element[2]
              }
              else if (element[1] == "PI_2.2") {
                this.AllData[3][2] += element[2]
              }
              else if (element[1] == "PI_2.3") {
                this.AllData[3][3] += element[2]
              }
              else if (element[1] == "PI_2.4") {
                this.AllData[3][4] += element[2]
              }
              else if (element[1] == "PI_2.5") {
                this.AllData[3][5] += element[2]
              }

            }
          });
          this.AllData[1][2] += this.AllData[1][1]
          this.AllData[1][3] += this.AllData[1][2]
          this.AllData[1][4] += this.AllData[1][3]
          this.AllData[1][5] += this.AllData[1][4]
          this.AllData[2][2] += this.AllData[2][1]
          this.AllData[2][3] += this.AllData[2][2]
          this.AllData[2][4] += this.AllData[2][3]
          this.AllData[2][5] += this.AllData[2][4]
          this.AllData[3][2] += this.AllData[3][1]
          this.AllData[3][3] += this.AllData[3][2]
          this.AllData[3][4] += this.AllData[3][3]
          this.AllData[3][5] += this.AllData[3][4]




        }
        self = this;
        self.headersForBurnUp.forEach(element => {
          if (element == "PI_1")
            self.p1 = true
          if (element == "PI_2.1")
            self.p21 = true
          if (element == "PI_2.2")
            self.p22 = true
          if (element == "PI_2.3")
            self.p23 = true
          if (element == "PI_2.4")
            self.p24 = true
          if (element == "PI_2.5")
            self.p25 = true
          if (element == "PI_2.6")
            self.p26 = true
        })

        self.headersForBurnUp.unshift("Category");
        self.finished = false;
        self.isFile = false;

        

      },
      beforeMount: function(){

      }
    }
  }
  )

</script>
<style type="text/css">
  .box {
    height: 200px;
    width: 200px;
    text-align: center;
  }

  .red {
    background-color: red;
  }

  .green {
    background-color: green;
  }
</style>